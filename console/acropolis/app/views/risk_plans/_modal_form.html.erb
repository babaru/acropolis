<%= simple_form_for(@risk_plan, remote: true, html: {class: 'form-horizontal'}) do |f| %>

  <div class="modal-body">

  <%= f.error_notification %>

  <%= f.input :name %>

  <div class="form-group required risk_plan_parameter_id">
    <label class="required col-sm-2 control-label label-sm" for="risk_plan_thresholds"><%= t('activerecord.attributes.risk_plan.net_worth_thresholds') %></label>

    <div id="threshold-btn" class="col-sm-10">
    <div class="btn-toolbar">
        <%= content_tag :span, fa_icon('plus'), class: 'threshold-item-add-btn btn btn-primary btn-sm ' %>
    </div>
    </div>

    <div id="threshold-panel" class="col-sm-offset-2 col-sm-10">

      <% @risk_plan.net_worth_thresholds.each do |threshold| %>

      <%= render(partial: 'threshold_form_field', locals: {threshold_type_name: 'net_worth_threshold', threshold_id: threshold.id, threshold_parameter: threshold.parameter.id, threshold_relation_symbol: threshold.relation_symbol.id, threshold_value: threshold.value, parameters: Parameter.where('name like ?', '%net_worth%')}) %>

      <% end %>

    </div>
  </div>

  <%= f.input :is_enabled, as: :fui_boolean, wrapper: :fui_boolean %>

  </div>
  <div class="modal-footer">

  <%= link_to t('buttons.cancel'), "#", class: "btn btn-default", data: {dismiss: "modal"} %>
  <%= f.button :submit, t('buttons.save_changes'), class: 'btn-primary col-sm-offset-2' %>

  </div>

<% end %>

<script type="text/javascript">

function delete_threshold_field(item) {
  item.closest('.form-group').find('#risk_plan_net_worth_threshold_removal_flags_').val(true);
  item.closest('.form-group').hide();
}

(function ($) {

  $(function () {

    trim_ui();

    $('.threshold-item-delete-btn').unbind('click').bind('click', function() {
      delete_threshold_field($(this));
    });

    $('.threshold-item-add-btn').click(function() {
      $('#threshold-panel').append("<%= escape_javascript("#{render(partial: 'threshold_form_field', locals: {threshold_type_name: 'net_worth_threshold', threshold_id: nil, threshold_parameter: nil, threshold_relation_symbol: nil, threshold_value: nil, parameters: Parameter.where('name like ?', '%net_worth%')})}").html_safe %>");
      $('.threshold-item-delete-btn').unbind('click').bind('click', function() {
        delete_threshold_field($(this));
      })
    });

  });

}(jQuery));

</script>